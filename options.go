package ukpolice

import (
	"net/url"
)

// Option specifies parameters to various methods that support multiple variable
// choices.
type Option func(*url.Values)

// WithDate sets provided date URL parameters.
func WithDate(date string) Option {
	return func(v *url.Values) {
		v.Set("date", string(date))
	}
}

// WithLatLong sets provided latitude and longitude URL parameters.
func WithLatLong(latitude, longitude string) Option {
	return func(v *url.Values) {
		if v.Get("poly") != "" || v.Get("location_id") != "" {
			panic("error setting options: cannot set lat or long when url values poly or location_id are in use")
		}
		v.Set("lat", string(latitude))
		v.Set("lng", longitude)
	}
}

// WithPolygon sets provided polygon URL parameters.
func WithPolygon(poly string) Option {
	return func(v *url.Values) {
		if v.Get("lat") != "" || v.Get("lng") != "" || v.Get("location_id") != "" {
			panic("error setting options: cannot set Polygon when lat, long or location_id values are in use")
		}
		v.Set("poly", poly)
	}
}

// WithLocationID sets provided locationID URL parameters.
func WithLocationID(id string) Option {
	return func(v *url.Values) {
		if v.Get("lat") != "" || v.Get("lng") != "" || v.Get("poly") != "" {
			panic("error setting options: cannot set LocationID when lat, long or poly values are in use")
		}
		v.Set("location_id", id)
	}
}

// WithCrimeCategory sets provided crime category URL parameters.
func WithCrimeCategory(category string) Option {
	return func(v *url.Values) {
		v.Set("category", category)
	}
}

// WithForce sets provided force URL parameters.
func WithForce(force string) Option {
	return func(v *url.Values) {
		v.Set("force", force)
	}
}

func addOptions(baseURL string, opts ...Option) string {
	u, _ := url.Parse(baseURL)
	q := u.Query()
	for _, opt := range opts {
		opt(&q)
	}
	u.RawQuery = q.Encode()
	return u.String()
}
